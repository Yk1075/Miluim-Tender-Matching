# מדריך הפעלה - מערכת התאמת מכרזי דיור

## סקירה כללית
מערכת התאמת מכרזי דיור למילואימניקים ונכי צה"ל כוללת ממשק UI מתקדם ב-Streamlit ומערכת טסטים מקיפה.

## הקבצים שנוצרו

### 1. ממשק המשתמש
- **`tender_ui_streamlit.py`** - ממשק UI עיקרי ב-Streamlit
  - ממשק דו-שכבתי (30% טופס, 70% תוצאות)
  - תמיכה מלאה ב-RTL ועברית
  - אימות נתונים מובנה
  - הצגת תוצאות אינטראקטיבית

### 2. אסטרטגיית טסטים
- **`test_strategy.md`** - מסמך אסטרטגיית טסטים מקיף
- **`test_matching_core.py`** - טסטים עיקריים למערכת
- עבור כל רכיבי המערכת:
  - Unit Tests
  - Integration Tests
  - End-to-End Tests
  - Performance Tests

## הפעלת המערכת

### דרישות מערכת
```bash
pip install streamlit pandas numpy pytest
```

### הפעלת ממשק המשתמש
```bash
streamlit run tender_ui_streamlit.py
```

הממשק יהיה זמין בכתובת: `http://localhost:8501`

### הפעלת הטסטים
```bash
# הפעלת טסטים עיקריים
python -m pytest test_matching_core.py -v

# הפעלת כל הטסטים
python -m pytest -v

# הפעלה עם כיסוי קוד
python -m pytest --cov=. test_matching_core.py
```

## תכונות עיקריות של ממשק המשתמש

### 1. טופס קלט נתונים
- **פרטי שירות:**
  - ימי מילואים מ-7.10.23
  - תעודת מילואים פעיל
  - ימי מילואים ב-6 שנים
  - סיווג נכות

- **העדפות דיור:**
  - אזור מועדף
  - סטטוס חסר דיור
  - בן/בת זוג זכאי

### 2. אימות נתונים
- בדיקת שדות חובה
- וידוא זכאות בסיסית
- הודעות שגיאה ברורות

### 3. הצגת תוצאות
- סיכום פרופיל המשתמש
- רשימת מכרזים מתאימים
- פרטי מכרזים מלאים
- קישור ישיר לאתר רמ״י

### 4. עיצוב ונוחות
- תמיכה מלאה ב-RTL
- עיצוב מותאם לעברית
- ממשק אינטואיטיבי
- צבעים ואיקונים ברורים

## לוגיקת התאמת מכרזים

### קריטריוני זכאות
1. **חיילי מילואים:**
   - 45+ ימי מילואים מ-7.10.23, או
   - תעודת מילואים פעיל, או
   - 80+ ימי מילואים ב-6 שנים

2. **נכי צה"ל:**
   - נכות קשה, או
   - נכות 100% ומעלה

3. **התאמת אזור:**
   - התאמה מדויקת לאזור המועדף

4. **התאמת דיור:**
   - חסרי דיור למכרזים ייעודיים
   - כולם למכרזים כלליים

### דוגמאות תרחישים

#### תרחיש 1: חייל מילואים מהדרום
```
קלט:
- 60 ימי מילואים מ-7.10.23
- אזור מועדף: דרום
- לא חסר דיור

תוצאה:
✅ זכאי כחייל מילואים
✅ מכרזים באזור דרום
✅ מגרשים בעדיפות למילואים
```

#### תרחיש 2: נכה צה"ל חסר דיור
```
קלט:
- נכות 100%
- אזור מועדף: מרכז
- חסר דיור

תוצאה:
✅ זכאי כנכה צה"ל
✅ מכרזים במרכז
✅ מגרשים בעדיפות לנכי צה"ל
✅ מכרזים לחסרי דיור
```

## טסטים ואיכות קוד

### כיסוי הטסטים
- **Unit Tests**: בדיקת פונקציות בודדות
- **Integration Tests**: בדיקת אינטראקציה בין רכיבים  
- **End-to-End Tests**: בדיקת תרחישי משתמש מלאים
- **Performance Tests**: בדיקת זמני תגובה

### הרצת בדיקות איכות
```bash
# בדיקת פורמט קוד
black *.py

# בדיקת סגנון
flake8 *.py

# בדיקת סוגים
mypy *.py

# כיסוי טסטים
coverage run -m pytest
coverage report
coverage html
```

## פתרון בעיות נפוצות

### 1. שגיאת "קובץ נתונים לא נמצא"
**בעיה:** המערכת לא מוצאת את קבצי הנתונים
**פתרון:**
```bash
# ודא שהקבצים קיימים
ls data/csv_output/

# ודא נתיב נכון
pwd
```

### 2. שגיאת "אינך זכאי להטבות"
**בעיה:** הפרופיל לא עומד בקריטריוני זכאות
**פתרון:**
- ודא שהזנת לפחות 45 ימי מילואים מ-7.10.23, או
- ודא שיש לך תעודת מילואים פעיל, או
- ודא שצברת 80+ ימי מילואים ב-6 שנים, או
- ודא שיש לך סיווג נכות מתאים

### 3. שגיאת Streamlit
**בעיה:** הממשק לא נטען
**פתרון:**
```bash
# עדכן Streamlit
pip install --upgrade streamlit

# נקה cache
streamlit cache clear

# הפעל מחדש
streamlit run tender_ui_streamlit.py
```

## הגדרות מתקדמות

### התאמת CSS
ניתן לערוך את הסגנונות ב-`tender_ui_streamlit.py` בחלק:
```python
st.markdown("""
<style>
    /* כאן ניתן לערוך את הסגנונות */
</style>
""", unsafe_allow_html=True)
```

### הוספת אזורים חדשים
לעדכון רשימת האזורים, ערוך את:
```python
preferred_area = st.selectbox(
    "אזור מועדף",
    options=["דרום", "צפון", "ירושלים", "מרכז", "יהודה ושומרון", "אזור חדש"]
)
```

### עדכון חוקי זכאות
לשינוי קריטריוני הזכאות, ערוך את הפונקציות ב-`create_comprehensive_matches.py`:
- `is_miluim_soldier()`
- `get_profile_category()`
- `check_eligibility_match()`

## תמיכה ועזרה

### לוגים ודיבוג
```python
# הפעלת מצב debug
import logging
logging.basicConfig(level=logging.DEBUG)
```

### בדיקת סטטוס המערכת
```bash
# בדיקת תלויות
pip list

# בדיקת גרסאות
python --version
streamlit --version
```

### יצירת קשר
לתמיכה טכנית: yuvalk@apm.law

---

## סיכום
המערכת מספקת פתרון מלא להתאמת מכרזי דיור עם ממשק ידידותי ומערכת טסטים מקיפה. 

עקבו אחר המדריך לשימוש נכון והפעלה תקינה של כל הרכיבים. 